<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Wash Pro | Учет мойки</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-dark: #0f172a;
            --color-darker: #0a0f1c;
            --color-primary: #1e40af;
            --color-primary-light: #3b82f6;
            --color-secondary: #475569;
            --color-accent: #06b6d4;
            --color-light: #f1f5f9;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-card: rgba(30, 41, 59, 0.8);
            --border-radius: 14px;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(145deg, var(--color-darker), #1e293b);
            color: var(--color-light);
            min-height: 100vh;
            padding-bottom: 40px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
        }

        /* Анимации */
        @keyframes slideDown {
            from { transform: translateY(-40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideInRight {
            from { right: -400px; opacity: 0; }
            to { right: 0; opacity: 1; }
        }

        /* Шапка с погодой */
        header {
            padding: 1.5rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(15px);
            margin-bottom: 2rem;
            animation: slideDown 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .logo {
            font-family: 'Exo 2', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
            position: relative;
            animation: bounceIn 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .logo i {
            margin-right: 15px;
            color: var(--color-accent);
            animation: float 3s ease-in-out infinite;
        }

        /* Виджет погоды */
        .weather-widget {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.2);
            animation: fadeIn 1s ease 0.3s both;
            min-width: 300px;
        }

        .weather-icon {
            font-size: 2.5rem;
            color: var(--color-accent);
        }

        .weather-info {
            flex: 1;
        }

        .weather-temp {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--color-light);
            margin-bottom: 5px;
        }

        .weather-desc {
            color: var(--color-accent);
            font-size: 1rem;
            font-weight: 500;
        }

        .weather-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--color-secondary);
        }

        /* Номер машины */
        .car-plate-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .car-plate {
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            border: 3px solid #1a237e;
            border-radius: 10px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 0.8s ease 0.5s both;
            position: relative;
        }

        .russia-flag {
            width: 25px;
            height: 17px;
            background: linear-gradient(to bottom, white 33%, blue 33%, blue 66%, red 66%);
            border: 1px solid #333;
            border-radius: 2px;
        }

        .plate-number {
            font-family: 'Arial Black', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 3px;
            color: #1a237e;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
            background: white;
            padding: 5px 12px;
            border-radius: 5px;
            border: 2px solid #1a237e;
            min-width: 180px;
        }

        .region-code {
            font-family: 'Arial', sans-serif;
            font-size: 1.1rem;
            font-weight: bold;
            color: #1a237e;
            background: white;
            padding: 3px 8px;
            border-radius: 3px;
            border: 2px solid #1a237e;
        }

        .edit-plate-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .edit-plate-btn:hover {
            background: var(--color-primary-light);
            transform: rotate(15deg) scale(1.1);
        }

        /* Боковая корзина */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: var(--color-darker);
            z-index: 1000;
            transition: var(--transition);
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.5);
            border-left: 1px solid rgba(59, 130, 246, 0.3);
            padding: 25px;
            overflow-y: auto;
        }

        .cart-sidebar.active {
            right: 0;
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-accent);
        }

        .cart-header h3 {
            font-family: 'Exo 2', sans-serif;
            font-size: 1.8rem;
            color: var(--color-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-cart {
            background: var(--color-danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-cart:hover {
            transform: rotate(90deg) scale(1.1);
            background: #dc2626;
        }

        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .cart-item {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--color-warning);
            animation: scaleIn 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: var(--color-light);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .cart-item-desc {
            color: var(--color-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--color-warning);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .remove-from-cart {
            background: transparent;
            color: var(--color-danger);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .remove-from-cart:hover {
            background: rgba(239, 68, 68, 0.1);
            transform: scale(1.2);
        }

        .cart-total {
            background: var(--color-primary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 700;
            font-size: 1.4rem;
            margin-top: 20px;
            animation: pulse 2s infinite;
        }

        /* Кнопка корзины в углу */
        .cart-button {
            position: fixed;
            top: 100px;
            right: 30px;
            z-index: 999;
            background: linear-gradient(135deg, var(--color-warning), #f97316);
            color: white;
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .cart-button:hover {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 15px 40px rgba(245, 158, 11, 0.6);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--color-danger);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s infinite;
        }

        /* Основные вкладки */
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 35px;
            animation: fadeIn 1s ease 0.5s both;
        }

        .tab-btn {
            padding: 16px 32px;
            background: var(--color-card);
            border: none;
            border-radius: var(--border-radius);
            color: var(--color-light);
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tab-btn:hover {
            background: rgba(30, 64, 175, 0.4);
            transform: translateY(-5px);
            border-color: var(--color-accent);
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--color-primary), #3730a3);
            border-color: var(--color-accent);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
            transform: translateY(-3px);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .tab-content.active {
            display: block;
        }

        /* Карточки */
        .card {
            background: var(--color-card);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
            animation: fadeInUp 0.6s ease;
        }

        .card:hover {
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .card-title {
            font-family: 'Exo 2', sans-serif;
            font-size: 1.9rem;
            margin-bottom: 25px;
            color: var(--color-primary-light);
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Химия - ПЕРЕРАБОТАННЫЙ ДИЗАЙН */
        .chem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .chem-item {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-left: 4px solid var(--color-primary);
            transition: var(--transition);
            animation: scaleIn 0.4s ease;
            position: relative;
        }

        .chem-item.out-of-stock {
            border-left-color: var(--color-danger);
            opacity: 0.9;
            background: rgba(239, 68, 68, 0.08);
        }

        .chem-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .chem-name {
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--color-light);
            flex: 1;
        }

        .chem-price-tag {
            background: rgba(245, 158, 11, 0.2);
            color: var(--color-warning);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .chem-desc {
            color: #cbd5e1;
            font-size: 0.95rem;
            margin-bottom: 20px;
            flex-grow: 1;
        }

        .chem-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stock-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stock-label {
            color: var(--color-accent);
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 80px;
        }

        .stock-value {
            font-weight: 700;
            color: var(--color-light);
            font-size: 1.1rem;
            min-width: 50px;
            text-align: center;
        }

        .stock-slider {
            flex: 1;
        }

        .stock-slider input {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--color-secondary);
            outline: none;
            -webkit-appearance: none;
            transition: var(--transition);
        }

        .stock-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--color-accent);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            border: 2px solid white;
        }

        .stock-slider input::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            background: var(--color-primary-light);
        }

        .chem-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .add-to-cart-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, var(--color-warning), #f97316);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-to-cart-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }

        .add-to-cart-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .add-to-cart-btn.added {
            background: linear-gradient(135deg, var(--color-success), #059669);
        }

        .toggle-stock-btn {
            padding: 12px 20px;
            background: transparent;
            color: var(--color-secondary);
            border: 2px solid var(--color-secondary);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .toggle-stock-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
            transform: translateY(-2px);
        }

        /* Алгоритм */
        .algo-steps {
            counter-reset: step-counter;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .algo-step {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 22px;
            display: flex;
            align-items: flex-start;
            border-left: 4px solid var(--color-accent);
            transition: var(--transition);
            animation: fadeInUp 0.4s ease;
        }

        .algo-step:hover {
            background: rgba(30, 64, 175, 0.2);
            transform: translateX(10px);
        }

        .algo-step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            background: var(--color-accent);
            color: var(--color-dark);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            margin-right: 20px;
            flex-shrink: 0;
            font-family: 'Exo 2', sans-serif;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .algo-step h4 {
            color: var(--color-light);
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .algo-step p {
            color: #cbd5e1;
            font-size: 1rem;
        }

        /* Счетчик и журнал */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--color-primary), #3730a3);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeInUp 0.5s ease;
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(145deg, var(--color-success), #059669);
            animation-delay: 0.1s;
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(145deg, var(--color-warning), #d97706);
            animation-delay: 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: white;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            font-family: 'Exo 2', sans-serif;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 500;
            letter-spacing: 1px;
        }

        /* Кнопка добавления мойки */
        #add-wash-btn {
            background: linear-gradient(145deg, var(--color-success), var(--color-accent));
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: var(--border-radius);
            font-family: 'Exo 2', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 35px auto;
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
            animation: fadeInUp 0.6s ease 0.3s both;
        }

        #add-wash-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(16, 185, 129, 0.6);
        }

        #add-wash-btn i {
            font-size: 1.5rem;
        }

        /* Форма добавления мойки */
        .wash-form {
            background: var(--color-card);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-top: 20px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            animation: fadeInUp 0.5s ease;
        }

        .form-group {
            margin-bottom: 25px;
            animation: fadeInUp 0.4s ease;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--color-primary-light);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control {
            width: 100%;
            padding: 16px;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid var(--color-secondary);
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--color-accent);
            outline: none;
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.2);
        }

        /* Чеклист химии */
        .chems-checklist {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            background: rgba(15, 23, 42, 0.5);
            padding: 25px;
            border-radius: 12px;
            border: 2px dashed var(--color-secondary);
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .checklist-item:hover {
            background: rgba(30, 64, 175, 0.2);
            border-color: var(--color-primary);
            transform: translateY(-3px);
        }

        .checklist-item input {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--color-success);
            transform: scale(1.2);
        }

        .checklist-item label {
            color: var(--color-light);
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            margin: 0;
            font-size: 1rem;
        }

        /* Загрузка фото - КРАСИВЫЕ РАМКИ */
        .photo-upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .photo-upload-section {
                grid-template-columns: 1fr;
            }
        }

        .photo-upload-box {
            background: rgba(15, 23, 42, 0.5);
            border: 3px solid var(--color-secondary);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .photo-upload-box::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--color-accent), var(--color-primary-light), var(--color-accent));
            border-radius: 17px;
            z-index: -1;
            opacity: 0;
            transition: var(--transition);
        }

        .photo-upload-box:hover::before {
            opacity: 1;
            animation: pulse 2s infinite;
        }

        .photo-upload-box:hover {
            transform: translateY(-5px);
            border-color: var(--color-accent);
        }

        .photo-upload-box i {
            font-size: 3.5rem;
            color: var(--color-accent);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .photo-upload-box:hover i {
            transform: scale(1.2);
            color: var(--color-primary-light);
        }

        .photo-upload-box h4 {
            color: var(--color-light);
            margin-bottom: 10px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .photo-upload-box p {
            color: #cbd5e1;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .photo-upload-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2;
        }

        .photo-upload-btn:hover {
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .photo-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            border: 3px solid var(--color-accent);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .photo-preview.active {
            display: block;
            animation: scaleIn 0.5s ease;
        }

        /* История моек */
        #wash-history {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .history-item {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid var(--color-success);
            transition: var(--transition);
            animation: fadeInUp 0.4s ease;
        }

        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border-left-color: var(--color-accent);
        }

        .history-date {
            font-weight: 800;
            color: var(--color-accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-date i {
            animation: pulse 2s infinite;
        }

        .history-details {
            color: #cbd5e1;
            margin-bottom: 12px;
            font-size: 1.05rem;
        }

        .history-chems {
            font-size: 0.95rem;
            color: var(--color-warning);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .history-chems span {
            background: rgba(245, 158, 11, 0.15);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            transition: var(--transition);
        }

        .history-chems span:hover {
            background: rgba(245, 158, 11, 0.25);
            transform: scale(1.05);
        }

        /* Фото в истории с красивыми рамками */
        .history-photos {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .history-photo {
            flex: 1;
            min-width: 280px;
            position: relative;
        }

        .history-photo img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 12px;
            border: 4px solid transparent;
            background: linear-gradient(45deg, var(--color-accent), var(--color-primary-light)) border-box;
            -webkit-mask: 
                linear-gradient(#fff 0 0) padding-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .history-photo img:hover {
            transform: scale(1.03);
            box-shadow: 0 15px 40px rgba(6, 182, 212, 0.3);
        }

        .history-photo-label {
            font-size: 0.9rem;
            color: var(--color-accent);
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
            background: rgba(15, 23, 42, 0.8);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .no-photo {
            color: var(--color-secondary);
            font-style: italic;
            font-size: 0.95rem;
            padding: 20px;
            text-align: center;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
            border: 2px dashed var(--color-secondary);
            width: 100%;
        }

        /* Кнопки действий */
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .action-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .action-btn.save {
            background: linear-gradient(145deg, var(--color-success), #059669);
            color: white;
        }

        .action-btn.cancel {
            background: linear-gradient(145deg, var(--color-secondary), #4b5563);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        /* Футер */
        footer {
            text-align: center;
            margin-top: 60px;
            color: var(--color-secondary);
            font-size: 0.9rem;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 1s ease;
        }

        /* Адаптивность для телефонов */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header-top {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .logo-container {
                align-items: center;
            }
            
            .logo {
                font-size: 2.2rem;
            }
            
            .weather-widget {
                min-width: 100%;
            }
            
            .car-plate-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .car-plate {
                padding: 8px 15px;
            }
            
            .plate-number {
                font-size: 1.5rem;
                min-width: 150px;
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .cart-button {
                top: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 1.3rem;
            }
            
            .tabs {
                gap: 10px;
            }
            
            .tab-btn {
                padding: 14px 20px;
                font-size: 1rem;
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .chem-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-value {
                font-size: 2.8rem;
            }
            
            .chems-checklist {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .history-photo {
                min-width: 100%;
            }
        }

        /* Затемнение фона */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Затемнение фона -->
    <div class="overlay" id="overlay"></div>

    <!-- Шапка с погодой -->
    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo-container">
                    <h1 class="logo"><i class="fas fa-car"></i>Car Wash Pro</h1>
                    
                    <div class="car-plate-container">
                        <div class="car-plate">
                            <div class="russia-flag"></div>
                            <div class="plate-number" id="plate-number">А123БВ</div>
                            <div class="region-code">777</div>
                        </div>
                        <button class="edit-plate-btn" id="edit-plate-btn">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Виджет погоды -->
                <div class="weather-widget" id="weather-widget">
                    <div class="weather-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="weather-info">
                        <div class="weather-temp" id="weather-temp">--°C</div>
                        <div class="weather-desc" id="weather-desc">Загрузка...</div>
                        <div class="weather-details">
                            <span id="weather-location">Ярославль</span>
                            <span id="weather-updated">Обновляется...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Кнопка корзины -->
    <button class="cart-button" id="cart-button">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count">0</span>
    </button>

    <!-- Боковая панель корзины -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-cart"></i> Корзина покупок</h3>
            <button class="close-cart" id="close-cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cart-items">
            <!-- Товары будут здесь -->
            <div class="empty-cart" style="text-align: center; color: var(--color-secondary); padding: 40px 20px;">
                <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                <p>Корзина пуста</p>
                <p style="font-size: 0.9rem; margin-top: 10px;">Добавьте товары из раздела "Моя химия"</p>
            </div>
        </div>
        <div class="cart-total" id="cart-total" style="display: none;">
            Итого: <span id="total-price">0</span> ₽
        </div>
    </div>

    <!-- Модальное окно редактирования номера -->
    <div class="overlay" id="plate-edit-overlay" style="display: none; z-index: 2000;">
        <div style="background: var(--color-darker); border-radius: var(--border-radius); padding: 30px; max-width: 400px; margin: 100px auto; border: 2px solid var(--color-accent);">
            <h3 style="color: var(--color-accent); margin-bottom: 20px; font-family: 'Exo 2', sans-serif;">
                <i class="fas fa-car"></i> Изменить номер машины
            </h3>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: var(--color-light);">Номер:</label>
                <input type="text" id="edit-plate-input" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(30, 41, 59, 0.8); border: 2px solid var(--color-secondary); color: white; font-size: 1.2rem; text-align: center; letter-spacing: 2px;" maxlength="6" value="А123БВ">
            </div>
            <div style="display: flex; gap: 15px;">
                <button id="save-plate-btn" style="flex: 1; padding: 12px; background: var(--color-success); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-save"></i> Сохранить
                </button>
                <button id="cancel-plate-btn" style="flex: 1; padding: 12px; background: var(--color-secondary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Навигация -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="chemistry"><i class="fas fa-flask"></i> Моя химия</button>
            <button class="tab-btn" data-tab="algorithm"><i class="fas fa-list-ol"></i> Алгоритм мойки</button>
            <button class="tab-btn" data-tab="counter"><i class="fas fa-tachometer-alt"></i> Счётчик и журнал</button>
        </div>

        <!-- Вкладка Химии -->
        <div id="chemistry" class="tab-content active">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-prescription-bottle"></i> В наличии</h2>
                <div class="chem-grid" id="in-stock-list">
                    <!-- Список химии в наличии -->
                </div>
            </div>
            <div class="card">
                <h2 class="card-title"><i class="fas fa-shopping-cart"></i> Нет в наличии</h2>
                <div class="chem-grid" id="out-of-stock-list">
                    <!-- Список химии, которой нет -->
                </div>
            </div>
        </div>

        <!-- Вкладка Алгоритма -->
        <div id="algorithm" class="tab-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-spray-can"></i> Алгоритм мойки авто</h2>
                <div class="algo-steps" id="algo-steps-container">
                    <!-- Шаги алгоритма -->
                </div>
            </div>
        </div>

        <!-- Вкладка Счётчика и журнала -->
        <div id="counter" class="tab-content">
            <div class="stats">
                <div class="stat-card pulse">
                    <i class="fas fa-car stat-icon"></i>
                    <div class="stat-value" id="total-washes">0</div>
                    <div class="stat-label">Всего моек</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-check stat-icon"></i>
                    <div class="stat-value" id="last-wash">--</div>
                    <div class="stat-label">Последняя мойка</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-prescription-bottle stat-icon"></i>
                    <div class="stat-value" id="chem-count">0</div>
                    <div class="stat-label">Химии в наличии</div>
                </div>
            </div>

            <button id="add-wash-btn"><i class="fas fa-plus-circle"></i> Добавить новую мойку</button>

            <!-- Форма добавления мойки -->
            <div id="wash-form-container" style="display: none;">
                <div class="wash-form">
                    <h3 class="card-title"><i class="fas fa-soap"></i> Запись о мойке</h3>
                    
                    <div class="form-group">
                        <label><i class="far fa-calendar"></i> Дата мойки</label>
                        <input type="date" id="wash-date" class="form-control">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-flask"></i> Использованная химия</label>
                        <div class="chems-checklist" id="chems-checklist">
                            <!-- Чеклист химии -->
                        </div>
                    </div>

                    <!-- Загрузка фото -->
                    <div class="form-group">
                        <label><i class="fas fa-camera"></i> Фотографии мойки</label>
                        <div class="photo-upload-section">
                            <div class="photo-upload-box" id="before-upload">
                                <i class="fas fa-car"></i>
                                <h4>Фото "До" мойки</h4>
                                <p>Загрузите фото автомобиля до мойки</p>
                                <button type="button" class="photo-upload-btn" data-type="before">
                                    <i class="fas fa-upload"></i> Выбрать фото
                                </button>
                                <input type="file" id="before-photo-input" accept="image/*" style="display: none;">
                                <img id="before-preview" class="photo-preview" alt="Предпросмотр фото 'до'">
                            </div>

                            <div class="photo-upload-box" id="after-upload">
                                <i class="fas fa-car-side"></i>
                                <h4>Фото "После" мойки</h4>
                                <p>Загрузите фото автомобиля после мойки</p>
                                <button type="button" class="photo-upload-btn" data-type="after">
                                    <i class="fas fa-upload"></i> Выбрать фото
                                </button>
                                <input type="file" id="after-photo-input" accept="image/*" style="display: none;">
                                <img id="after-preview" class="photo-preview" alt="Предпросмотр фото 'после'">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-comment"></i> Дополнительные заметки (необязательно)</label>
                        <textarea id="wash-notes" class="form-control" rows="3" placeholder="Например: Особо грязные колёса, использовал двойную порцию пены..."></textarea>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn save" id="save-wash-btn">
                            <i class="fas fa-save"></i> Сохранить мойку
                        </button>
                        <button class="action-btn cancel" id="cancel-wash-btn">
                            <i class="fas fa-times"></i> Отмена
                        </button>
                    </div>
                </div>
            </div>

            <!-- История моек -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-history"></i> История моек</h2>
                <div id="wash-history">
                    <div style="text-align: center; color: var(--color-secondary); padding: 40px 20px;" id="no-history">
                        <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5; display: block;"></i>
                        История моек пуста<br>
                        <span style="font-size: 0.9rem;">Добавьте первую запись!</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Футер -->
        <footer>
            <p>Car Wash Pro v2.1 • Персональная система учёта • Данные сохраняются в вашем браузере</p>
        </footer>
    </div>

    <script>
        // ИНИЦИАЛИЗАЦИЯ ДАННЫХ
        let washCount = parseInt(localStorage.getItem('washCount')) || 0;
        let lastWashDate = localStorage.getItem('lastWashDate') || '--';
        let washHistory = JSON.parse(localStorage.getItem('washHistory')) || [];
        let currentBeforePhoto = null;
        let currentAfterPhoto = null;
        let cartItems = JSON.parse(localStorage.getItem('carWashCart')) || [];
        let cartTotal = 0;
        let carPlate = localStorage.getItem('carPlate') || 'А123БВ';

        // Алгоритм мойки
        let algorithm = JSON.parse(localStorage.getItem('carWashAlgorithm')) || [
            "Намочить всю машину водой",
            "Пена бесконтактная: Нанести → ждать 3-5 мин → смыть",
            "Колёса и арки: Очистить диски и шины → смыть",
            "Пена контактная (2 ведра): Мыть кузов сверху вниз → сполоснуть",
            "Гидрофоб (ВАЖНО): Нанести на влажный кузов → ждать ~1 мин → смыть водой",
            "Сушка: Воздуховодка → резиновая тряпка → микрофибра",
            "Финиш: Колёса (чернитель) → салон"
        ];

        // Химия с ценами из вашего списка
        let chemicals = JSON.parse(localStorage.getItem('carWashChemicals')) || [
            // В наличии
            { id: 1, name: "01 safe (первая фаза)", price: 631, desc: "Бесконтактная пена", stock: 80, inStock: true },
            { id: 2, name: "14 multicomplex", price: 335, desc: "Химчистка салона", stock: 65, inStock: true },
            { id: 3, name: "22 lord stone", price: 458, desc: "Водный камень", stock: 40, inStock: true },
            { id: 4, name: "Lavr storm", price: 501, desc: "Контактная пена", stock: 30, inStock: true },
            { id: 5, name: "32 black kiss", price: 388, desc: "Чернитель шин", stock: 25, inStock: true },
            { id: 6, name: "27 black round", price: 561, desc: "Гелевый чернитель", stock: 90, inStock: true },
            { id: 7, name: "Губка крупнопористая", price: 408, desc: "Для контактной мойки", stock: 100, inStock: true },
            { id: 8, name: "Полироль салона lcse", price: 426, desc: "Уход за пластиком", stock: 60, inStock: true },
            { id: 9, name: "Средство для экранов attace", price: 350, desc: "Очистка дисплеев", stock: 75, inStock: true },
            { id: 10, name: "33 quartz energy", price: 455, desc: "Кварцевое покрытие", stock: 20, inStock: true },
            { id: 11, name: "Тряпка микрофибра", price: 400, desc: "Для сушки", stock: 95, inStock: true },
            { id: 12, name: "Тряпка резиновая", price: 186, desc: "Для сушки стёкол", stock: 50, inStock: true },
            { id: 13, name: "Щетка для шин", price: 369, desc: "Очистка резины", stock: 100, inStock: true },
            { id: 14, name: "Щетка для дисков из микрофибры", price: 350, desc: "Чистка дисков", stock: 100, inStock: true },
            // Нет в наличии
            { id: 15, name: "03 too shampoo", price: 350, desc: "Шампунь для мойки", stock: 0, inStock: false },
            { id: 16, name: "Очиститель резины detail", price: 450, desc: "Для резиновых уплотнителей", stock: 0, inStock: false },
            { id: 17, name: "28 bug fix", price: 386, desc: "От насекомых", stock: 0, inStock: false },
            { id: 18, name: "Очиститель дисков (iron detail)", price: 571, desc: "Сильное средство для дисков", stock: 0, inStock: false },
            { id: 19, name: "Polish fiber", price: 382, desc: "Тряпка для полировки", stock: 0, inStock: false },
            { id: 20, name: "Glass fiber", price: 338, desc: "Для стёкол", stock: 0, inStock: false },
        ];

        // ИНИЦИАЛИЗАЦИЯ ПРИ ЗАГРУЗКЕ
        document.addEventListener('DOMContentLoaded', function() {
            // Устанавливаем номер машины
            document.getElementById('plate-number').textContent = carPlate;
            
            // Загружаем погоду
            loadWeather();
            
            // Обновляем данные каждые 30 минут
            setInterval(loadWeather, 30 * 60 * 1000);
            
            renderChemicals();
            renderAlgorithm();
            updateStats();
            renderWashHistory();
            setupEventListeners();
            updateCart();
            
            // Анимация загрузки
            setTimeout(() => {
                document.querySelectorAll('.card').forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                });
            }, 100);
        });

        // ПОГОДА - РЕАЛЬНЫЕ ДАННЫЕ
        async function loadWeather() {
            try {
                // Используем бесплатный API для погоды
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=57.63&longitude=39.87&current_weather=true&timezone=Europe%2FMoscow');
                const data = await response.json();
                
                if (data.current_weather) {
                    const temp = Math.round(data.current_weather.temperature);
                    const weatherCode = data.current_weather.weathercode;
                    
                    document.getElementById('weather-temp').textContent = `${temp}°C`;
                    
                    // Преобразуем код погоды в описание
                    const weatherDesc = getWeatherDescription(weatherCode);
                    document.getElementById('weather-desc').textContent = weatherDesc;
                    
                    // Обновляем время
                    const updateTime = new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
                    document.getElementById('weather-updated').textContent = `Обновлено: ${updateTime}`;
                    
                    // Меняем иконку в зависимости от погоды
                    const weatherIcon = document.querySelector('.weather-icon i');
                    weatherIcon.className = getWeatherIcon(weatherCode);
                }
            } catch (error) {
                console.error('Ошибка загрузки погоды:', error);
                // Резервные данные
                document.getElementById('weather-temp').textContent = '--°C';
                document.getElementById('weather-desc').textContent = 'Нет данных';
                document.getElementById('weather-updated').textContent = 'Ошибка загрузки';
            }
        }

        function getWeatherDescription(code) {
            // Коды погоды от Open-Meteo
            if (code === 0) return 'Ясно';
            if (code <= 3) return 'Переменная облачность';
            if (code <= 48) return 'Туман';
            if (code <= 55) return 'Морось';
            if (code <= 65) return 'Дождь';
            if (code <= 77) return 'Снег';
            if (code <= 82) return 'Ливень';
            if (code <= 86) return 'Снегопад';
            if (code <= 99) return 'Гроза';
            return 'Облачно';
        }

        function getWeatherIcon(code) {
            if (code === 0) return 'fas fa-sun';
            if (code <= 3) return 'fas fa-cloud-sun';
            if (code <= 48) return 'fas fa-smog';
            if (code <= 55) return 'fas fa-cloud-rain';
            if (code <= 65) return 'fas fa-cloud-showers-heavy';
            if (code <= 77) return 'fas fa-snowflake';
            if (code <= 82) return 'fas fa-poo-storm';
            if (code <= 86) return 'fas fa-snowman';
            if (code <= 99) return 'fas fa-bolt';
            return 'fas fa-cloud';
        }

        // РЕНДЕР ХИМИИ
        function renderChemicals() {
            const inStockList = document.getElementById('in-stock-list');
            const outOfStockList = document.getElementById('out-of-stock-list');
            inStockList.innerHTML = '';
            outOfStockList.innerHTML = '';

            chemicals.forEach(chem => {
                const chemElement = document.createElement('div');
                chemElement.className = `chem-item ${chem.inStock ? '' : 'out-of-stock'}`;
                const isInCart = cartItems.some(item => item.id === chem.id);
                
                chemElement.innerHTML = `
                    <div class="chem-header">
                        <div class="chem-name">${chem.name}</div>
                        <div class="chem-price-tag">${chem.price} ₽</div>
                    </div>
                    <div class="chem-desc">${chem.desc}</div>
                    <div class="chem-controls">
                        <div class="stock-control">
                            <span class="stock-label">Осталось:</span>
                            <span class="stock-value">${chem.stock}%</span>
                            <div class="stock-slider">
                                <input type="range" min="0" max="100" value="${chem.stock}" class="stock-input" 
                                       data-id="${chem.id}" ${!chem.inStock ? 'disabled' : ''}>
                            </div>
                        </div>
                        <div class="chem-actions">
                            <button class="add-to-cart-btn ${isInCart ? 'added' : ''}" 
                                    data-id="${chem.id}" ${!chem.inStock ? 'disabled' : ''}>
                                ${isInCart ? '<i class="fas fa-check"></i> В корзине' : '<i class="fas fa-cart-plus"></i> В корзину'}
                            </button>
                            <button class="toggle-stock-btn" data-id="${chem.id}">
                                ${chem.inStock ? '<i class="fas fa-arrow-down"></i> Закончилось' : '<i class="fas fa-arrow-up"></i> В наличии'}
                            </button>
                        </div>
                    </div>
                `;

                if (chem.inStock) {
                    inStockList.appendChild(chemElement);
                } else {
                    outOfStockList.appendChild(chemElement);
                }
            });

            attachChemicalEvents();
            updateChemCount();
            updateCartButton();
        }

        function attachChemicalEvents() {
            // Слайдеры количества
            document.querySelectorAll('.stock-input').forEach(slider => {
                slider.addEventListener('input', function() {
                    const id = parseInt(this.dataset.id);
                    const value = parseInt(this.value);
                    const chem = chemicals.find(c => c.id === id);
                    chem.stock = value;
                    
                    // Обновляем значение рядом
                    this.closest('.stock-control').querySelector('.stock-value').textContent = `${value}%`;
                    
                    saveChemicals();
                    
                    // Анимация изменения
                    const stockValue = this.closest('.stock-control').querySelector('.stock-value');
                    stockValue.style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        stockValue.style.animation = '';
                    }, 500);
                });
            });

            // Кнопки переключения наличия
            document.querySelectorAll('.toggle-stock-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const chem = chemicals.find(c => c.id === id);
                    chem.inStock = !chem.inStock;
                    
                    if (!chem.inStock) {
                        chem.stock = 0;
                        // Удаляем из корзины если больше нет в наличии
                        cartItems = cartItems.filter(item => item.id !== id);
                        saveCart();
                    }
                    
                    saveChemicals();
                    renderChemicals();
                    updateCart();
                    
                    // Показываем уведомление
                    showNotification(
                        chem.inStock ? 
                        `${chem.name} теперь в наличии` : 
                        `${chem.name} отмечено как закончившееся`,
                        chem.inStock ? 'success' : 'warning'
                    );
                });
            });

            // Кнопки добавления в корзину
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (this.disabled) return;
                    
                    const id = parseInt(this.dataset.id);
                    const chem = chemicals.find(c => c.id === id);
                    
                    if (this.classList.contains('added')) {
                        // Удаляем из корзины
                        cartItems = cartItems.filter(item => item.id !== id);
                        this.innerHTML = '<i class="fas fa-cart-plus"></i> В корзину';
                        this.classList.remove('added');
                        this.style.animation = 'scaleIn 0.3s';
                        
                        showNotification(`${chem.name} удален из корзины`, 'info');
                    } else {
                        // Добавляем в корзину
                        cartItems.push({
                            id: chem.id,
                            name: chem.name,
                            price: chem.price,
                            desc: chem.desc
                        });
                        this.innerHTML = '<i class="fas fa-check"></i> В корзине';
                        this.classList.add('added');
                        this.style.animation = 'bounceIn 0.5s';
                        
                        showNotification(`${chem.name} добавлен в корзину`, 'success');
                    }
                    
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 500);
                    
                    saveCart();
                    updateCart();
                    updateCartButton();
                });
            });
        }

        function saveChemicals() {
            localStorage.setItem('carWashChemicals', JSON.stringify(chemicals));
        }

        function updateChemCount() {
            const count = chemicals.filter(c => c.inStock).length;
            document.getElementById('chem-count').textContent = count;
        }

        // КОРЗИНА
        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');
            const totalPriceElement = document.getElementById('total-price');
            
            cartTotal = cartItems.reduce((sum, item) => sum + item.price, 0);
            
            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart" style="text-align: center; color: var(--color-secondary); padding: 40px 20px;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Корзина пуста</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Добавьте товары из раздела "Моя химия"</p>
                    </div>
                `;
                cartTotalElement.style.display = 'none';
            } else {
                cartItemsContainer.innerHTML = '';
                cartItems.forEach(item => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-desc">${item.desc}</div>
                            <div class="cart-item-price">${item.price} ₽</div>
                        </div>
                        <button class="remove-from-cart" data-id="${item.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    cartItemsContainer.appendChild(cartItemElement);
                });
                
                // Добавляем обработчики для кнопок удаления
                document.querySelectorAll('.remove-from-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        cartItems = cartItems.filter(item => item.id !== id);
                        saveCart();
                        updateCart();
                        renderChemicals();
                        updateCartButton();
                        
                        showNotification('Товар удален из корзины', 'info');
                    });
                });
                
                totalPriceElement.textContent = cartTotal;
                cartTotalElement.style.display = 'block';
                cartTotalElement.style.animation = 'pulse 1s';
                setTimeout(() => {
                    cartTotalElement.style.animation = '';
                }, 1000);
            }
            
            updateCartButton();
        }

        function updateCartButton() {
            const cartButton = document.getElementById('cart-button');
            const cartCount = cartButton.querySelector('.cart-count');
            cartCount.textContent = cartItems.length;
            
            if (cartItems.length > 0) {
                cartButton.style.animation = 'pulse 1.5s infinite';
            } else {
                cartButton.style.animation = '';
            }
        }

        function saveCart() {
            localStorage.setItem('carWashCart', JSON.stringify(cartItems));
        }

        // АЛГОРИТМ
        function renderAlgorithm() {
            const algoContainer = document.getElementById('algo-steps-container');
            algoContainer.innerHTML = '';
            
            algorithm.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'algo-step';
                stepElement.style.animationDelay = `${index * 0.1}s`;
                stepElement.innerHTML = `
                    <div>
                        <h4>Шаг ${index + 1}</h4>
                        <p>${step}</p>
                    </div>
                `;
                algoContainer.appendChild(stepElement);
            });

            // Заполняем чеклист химии для формы
            const chemsChecklist = document.getElementById('chems-checklist');
            chemsChecklist.innerHTML = '';
            chemicals.filter(c => c.inStock).forEach(chem => {
                const chemId = `chem-${chem.id}`;
                chemsChecklist.innerHTML += `
                    <div class="checklist-item">
                        <input type="checkbox" id="${chemId}" value="${chem.name}">
                        <label for="${chemId}">${chem.name}</label>
                    </div>
                `;
            });
        }

        // СТАТИСТИКА И ЖУРНАЛ
        function updateStats() {
            document.getElementById('total-washes').textContent = washCount;
            document.getElementById('last-wash').textContent = lastWashDate;
        }

        function renderWashHistory() {
            const historyContainer = document.getElementById('wash-history');
            const noHistory = document.getElementById('no-history');
            
            if (washHistory.length === 0) {
                noHistory.style.display = 'block';
                return;
            }
            
            noHistory.style.display = 'none';
            historyContainer.innerHTML = '';
            
            washHistory.reverse().forEach((wash, index) => {
                const washElement = document.createElement('div');
                washElement.className = 'history-item';
                washElement.style.animationDelay = `${index * 0.1}s`;
                
                let photosHTML = '';
                if (wash.beforePhoto || wash.afterPhoto) {
                    photosHTML = `
                        <div class="history-photos">
                            ${wash.beforePhoto ? 
                                `<div class="history-photo">
                                    <img src="${wash.beforePhoto}" alt="До мойки">
                                    <div class="history-photo-label">До мойки</div>
                                </div>` : 
                                '<div class="no-photo">Фото "до" не добавлено</div>'}
                            ${wash.afterPhoto ? 
                                `<div class="history-photo">
                                    <img src="${wash.afterPhoto}" alt="После мойки">
                                    <div class="history-photo-label">После мойки</div>
                                </div>` : 
                                '<div class="no-photo">Фото "после" не добавлено</div>'}
                        </div>
                    `;
                }
                
                washElement.innerHTML = `
                    <div class="history-date">
                        <i class="far fa-calendar"></i> ${wash.date}
                    </div>
                    <div class="history-details">
                        <strong>Использовано химии:</strong> ${wash.usedChems.length} позиций
                    </div>
                    ${wash.notes ? `<div class="history-details"><strong>Заметки:</strong> ${wash.notes}</div>` : ''}
                    ${wash.usedChems.length > 0 ? `
                        <div class="history-chems">
                            ${wash.usedChems.map(chem => `<span>${chem}</span>`).join('')}
                        </div>
                    ` : ''}
                    ${photosHTML}
                `;
                historyContainer.appendChild(washElement);
            });
        }

        function saveHistory() {
            localStorage.setItem('washHistory', JSON.stringify(washHistory));
            localStorage.setItem('washCount', washCount);
            localStorage.setItem('lastWashDate', lastWashDate);
        }

        // ЗАГРУЗКА ФОТОГРАФИЙ
        function setupPhotoUpload() {
            const beforeInput = document.getElementById('before-photo-input');
            const afterInput = document.getElementById('after-photo-input');
            const beforePreview = document.getElementById('before-preview');
            const afterPreview = document.getElementById('after-preview');
            const beforeUploadBtn = document.querySelector('[data-type="before"]');
            const afterUploadBtn = document.querySelector('[data-type="after"]');

            beforeUploadBtn.addEventListener('click', () => beforeInput.click());
            afterUploadBtn.addEventListener('click', () => afterInput.click());

            beforeInput.addEventListener('change', function(e) {
                handlePhotoUpload(e, 'before');
            });

            afterInput.addEventListener('change', function(e) {
                handlePhotoUpload(e, 'after');
            });

            // Обработка клика на контейнере
            document.getElementById('before-upload').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I' || e.target.tagName === 'H4' || e.target.tagName === 'P') return;
                beforeInput.click();
            });

            document.getElementById('after-upload').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I' || e.target.tagName === 'H4' || e.target.tagName === 'P') return;
                afterInput.click();
            });
        }

        function handlePhotoUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.match('image.*')) {
                alert('Пожалуйста, выберите файл изображения (JPG, PNG и т.д.)');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('Размер файла не должен превышать 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const dataUrl = e.target.result;
                const previewId = type === 'before' ? 'before-preview' : 'after-preview';
                const preview = document.getElementById(previewId);
                
                preview.src = dataUrl;
                preview.classList.add('active');
                preview.style.animation = 'scaleIn 0.5s';
                
                if (type === 'before') {
                    currentBeforePhoto = dataUrl;
                } else {
                    currentAfterPhoto = dataUrl;
                }
                
                setTimeout(() => {
                    preview.style.animation = '';
                }, 500);
                
                showNotification(`Фото "${type === 'before' ? 'До' : 'После'}" загружено`, 'success');
            };
            reader.readAsDataURL(file);
        }

        // ОБРАБОТЧИКИ СОБЫТИЙ
        function setupEventListeners() {
            // Переключение вкладок
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    document.querySelectorAll('.tab-btn, .tab-content').forEach(el => {
                        el.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Анимация переключения
                    this.style.animation = 'pulse 0.3s';
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 300);
                });
            });

            // Корзина
            const cartButton = document.getElementById('cart-button');
            const cartSidebar = document.getElementById('cart-sidebar');
            const closeCart = document.getElementById('close-cart');
            const overlay = document.getElementById('overlay');

            cartButton.addEventListener('click', function() {
                cartSidebar.classList.add('active');
                overlay.classList.add('active');
            });

            closeCart.addEventListener('click', function() {
                cartSidebar.classList.remove('active');
                overlay.classList.remove('active');
            });

            overlay.addEventListener('click', function() {
                cartSidebar.classList.remove('active');
                this.classList.remove('active');
            });

            // Редактирование номера машины
            const editPlateBtn = document.getElementById('edit-plate-btn');
            const plateEditOverlay = document.getElementById('plate-edit-overlay');
            const savePlateBtn = document.getElementById('save-plate-btn');
            const cancelPlateBtn = document.getElementById('cancel-plate-btn');
            const editPlateInput = document.getElementById('edit-plate-input');

            editPlateBtn.addEventListener('click', function() {
                editPlateInput.value = carPlate;
                plateEditOverlay.style.display = 'block';
                overlay.classList.add('active');
            });

            savePlateBtn.addEventListener('click', function() {
                const newPlate = editPlateInput.value.trim().toUpperCase();
                if (newPlate && newPlate.length === 6) {
                    carPlate = newPlate;
                    localStorage.setItem('carPlate', carPlate);
                    document.getElementById('plate-number').textContent = carPlate;
                    plateEditOverlay.style.display = 'none';
                    overlay.classList.remove('active');
                    
                    showNotification('Номер машины изменен', 'success');
                } else {
                    alert('Введите корректный номер (6 символов)');
                }
            });

            cancelPlateBtn.addEventListener('click', function() {
                plateEditOverlay.style.display = 'none';
                overlay.classList.remove('active');
            });

            // Добавление мойки
            document.getElementById('add-wash-btn').addEventListener('click', function() {
                document.getElementById('wash-form-container').style.display = 'block';
                this.style.display = 'none';
                document.getElementById('wash-date').valueAsDate = new Date();
                currentBeforePhoto = null;
                currentAfterPhoto = null;
                document.getElementById('before-preview').classList.remove('active');
                document.getElementById('after-preview').classList.remove('active');
                document.getElementById('wash-notes').value = '';
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            });

            // Отмена добавления мойки
            document.getElementById('cancel-wash-btn').addEventListener('click', function() {
                document.getElementById('wash-form-container').style.display = 'none';
                document.getElementById('add-wash-btn').style.display = 'flex';
                currentBeforePhoto = null;
                currentAfterPhoto = null;
            });

            // Сохранение мойки
            document.getElementById('save-wash-btn').addEventListener('click', function() {
                const date = document.getElementById('wash-date').value;
                if (!date) {
                    showNotification('Укажите дату мойки!', 'error');
                    return;
                }

                const usedChems = [];
                document.querySelectorAll('#chems-checklist input:checked').forEach(cb => {
                    usedChems.push(cb.value);
                });

                const notes = document.getElementById('wash-notes').value.trim();

                const washRecord = {
                    date: new Date(date).toLocaleDateString('ru-RU', {day: 'numeric', month: 'long', year: 'numeric'}),
                    usedChems,
                    notes: notes || null,
                    beforePhoto: currentBeforePhoto,
                    afterPhoto: currentAfterPhoto
                };

                washHistory.push(washRecord);
                washCount++;
                lastWashDate = washRecord.date;

                saveHistory();
                updateStats();
                renderWashHistory();

                // Сброс формы
                document.getElementById('wash-form-container').style.display = 'none';
                document.getElementById('add-wash-btn').style.display = 'flex';

                // Анимация успеха
                const statCards = document.querySelectorAll('.stat-card');
                statCards.forEach(card => {
                    card.style.animation = 'pulse 1s';
                    setTimeout(() => {
                        card.style.animation = '';
                    }, 1000);
                });
                
                showNotification('Мойка успешно добавлена!', 'success');
            });

            // Настройка загрузки фото
            setupPhotoUpload();
        }

        // Функция показа уведомления
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                background: ${type === 'success' ? 'var(--color-success)' : type === 'error' ? 'var(--color-danger)' : type === 'warning' ? 'var(--color-warning)' : 'var(--color-primary)'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: fadeInUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                display: flex;
                align-items: center;
                gap: 12px;
                font-weight: 600;
                max-width: 350px;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeInUp 0.5s reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
    </script>
</body>
</html>